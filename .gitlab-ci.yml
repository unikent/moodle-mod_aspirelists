image: skylarkelty/moodle-gitlab

cache:
    paths:
        - vendor/

services:
    - mysql:latest

variables:
    MYSQL_ROOT_PASSWORD: "moodle_ci_password"

stages:
    - checks

before_script:
    - export MOODLE_BRANCH=MOODLE_31_STABLE
    - export DB=mysqli
    - export PLUGIN=`pwd`
    - pwd
    - cd ..
    - echo $PLUGIN
    - pwd
    - ls -al
    - ls -al moodle
    - ls -al ci
    - ls -al moodle-mod_aspirelists
    - curl -sS https://getcomposer.org/installer | php
    - php composer.phar create-project -n --no-dev --prefer-dist moodlerooms/moodle-plugin-ci ci ^1
    - export PATH="$(cd ci/bin; pwd):$(cd ci/vendor/bin; pwd):$PATH"
    - ls -al
    - moodle-plugin-ci install --data /tmp --db-type mysqli --db-user root --db-pass moodle_ci_password --db-name moodle_ci --db-host mysql

linter:
    stage: checks
    script:
        - moodle-plugin-ci phplint
